<link rel="import" href="../../bower_components/polymer/polymer.html">
<dom-module id="global-data">
    <template>
        <custom-style>
        </custom-style>
        <style>

        </style>
    </template>
    <div></div>
    <script>
var __globalRef = {
    locale: null,
    device: null,
    // update: function() {
    //    // this.__listeners.forEach(item => item.update());
    // },
    __listeners: []
};
document.addEventListener('deviceready', function () {

    if (window.localStorage.getItem("lang") == null) {
        window.localStorage.setItem("lang", "en");
    }

    console.log(window.localStorage.getItem("lang"));
    __globalRef.device = cordova.platformId;
    console.log(cordova.platformId);
    // __globalRef.update();
}, false);

var GlobalData = function (_Polymer$Element) {
    babelHelpers.inherits(GlobalData, _Polymer$Element);
    babelHelpers.createClass(GlobalData, [{
        key: "update",
        value: function update() {
            this.locale = this.globalRef.locale;
            this.device = this.globalRef.device;
        }
    }, {
        key: "setLocale",
        value: function setLocale(newLocale, oldLocale) {
            this.locale = newLocale;
            this.globalRef.locale = newLocale;
            //made the change in my-app so that there is no constant writing in loop
            // if (this.locale != null) {
            //     window.localStorage.setItem("lang", this.globalRef.locale);
            // }

            // this.globalRef.update();
        }
    }, {
        key: "setDevice",
        value: function setDevice(newDevice, oldDevice) {
            this.device = newDevice;
            this.globalRef.device = newDevice;
            //  this.globalRef.update();
        }
    }, {
        key: "_getLocale",
        value: function _getLocale(ref) {
            return ref.locale;
        }
    }, {
        key: "_getDevice",
        value: function _getDevice(ref) {
            return ref.device;
        }
    }], [{
        key: "is",
        get: function get() {
            return 'global-data';
        }
    }, {
        key: "properties",
        get: function get() {
            return {
                locale: {
                    type: String,
                    reflectToAttribute: true,
                    notify: true,
                    observer: 'setLocale'
                },
                device: {
                    type: String,
                    reflectToAttribute: true,
                    notify: true,
                    observer: 'setDevice'
                },
                globalRef: {
                    type: Object,
                    value: __globalRef
                }

            };
        }
    }, {
        key: "observers",
        get: function get() {
            return [];
        }
    }]);

    function GlobalData() {
        babelHelpers.classCallCheck(this, GlobalData);
        return babelHelpers.possibleConstructorReturn(this, (GlobalData.__proto__ || Object.getPrototypeOf(GlobalData)).call(this));
        // __globalRef.__listeners.push(this);
    }

    babelHelpers.createClass(GlobalData, [{
        key: "ready",
        value: function ready() {
            babelHelpers.get(GlobalData.prototype.__proto__ || Object.getPrototypeOf(GlobalData.prototype), "ready", this).call(this);
            //this.update();
        }
    }]);
    return GlobalData;
}(Polymer.Element);

customElements.define(GlobalData.is, GlobalData);</script>
</dom-module>
