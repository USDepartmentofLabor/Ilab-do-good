<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
--><link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/app-layout/app-drawer/app-drawer.html">
<link rel="import" href="../bower_components/app-layout/app-drawer-layout/app-drawer-layout.html">
<link rel="import" href="../bower_components/app-layout/app-header/app-header.html">
<link rel="import" href="../bower_components/app-layout/app-header-layout/app-header-layout.html">
<link rel="import" href="../bower_components/app-layout/app-scroll-effects/app-scroll-effects.html">
<link rel="import" href="../bower_components/app-layout/app-toolbar/app-toolbar.html">
<link rel="import" href="../bower_components/app-route/app-location.html">
<link rel="import" href="../bower_components/app-route/app-route.html">
<link rel="import" href="../bower_components/iron-pages/iron-pages.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/iron-icons/maps-icons.html">
<link rel="import" href="../bower_components/iron-icons/social-icons.html">
<link rel="import" href="../bower_components/iron-icons/communication-icons.html">
<link rel="import" href="../bower_components/iron-selector/iron-selector.html">
<link rel="import" href="../bower_components/iron-a11y-keys/iron-a11y-keys.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-styles/paper-styles.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../bower_components/iron-collapse/iron-collapse.html">
<link rel="import" href="my-icons.html">
<link rel="import" href="./elements/bread-crumbs.html">
<link rel="import" href="./elements/chain-anchor-link.html">
<link rel="import" href="./elements/expandable-item.html">
<link rel="import" href="./elements/expandable-item-no-icon.html">
<link rel="import" href="./elements/render-raw.html">
<link rel="import" href="./elements/localized.html">
<link rel="import" href="./elements/global-data.html">
<link rel="import" href="./elements/app-link.html">
<link rel="import" href="./elements/platform-switch.html">
<link rel="import" href="./elements/border-separator.html">
<link rel="import" href="./elements/big-border-separator.html">
<link rel="import" href="./info-sub-page.html">
<link rel="import" href="./index-info.html">
<link rel="import" href="./home.html">
<link rel="import" href="./home-fr.html">
<link rel="import" href="./home-es.html">
<link rel="import" href="./info.html">
<link rel="import" href="./search-results.html">
<link rel="import" href="./topic.html">
<link rel="import" href="./step.html">
<link rel="import" href="./steps-landing.html">
<dom-module id="my-app">
    <template>
        <style include="iron-flex"></style>
        <style include="paper-material-styles"></style>
        <style>
         :host {
            --app-primary-color: rgb(0, 51, 84);
            --app-secondary-color: black;
            display: block;
        }

        app-header {
            color: #fff;
            background-color: var(--app-primary-color);
        }

        app-header paper-icon-button {
            --paper-icon-button-ink-color: white;
        }

        .drawer-list {
            margin: 0 20px;
        }

        .drawer-list app-link,
        .drawer-list a {
            display: block;
            padding: 0 16px;
            text-decoration: none;
            color: var(--app-secondary-color);
            line-height: 40px;
        }

        .drawer-list app-link {
            width: 100%;
            padding: 0 0 0 16px;
        }

        .drawer-list app-link.iron-selected,
        .drawer-list>li.iron-selected>app-link,
        .drawer-list>expandable-item.iron-selected>div>app-link {
            color: black;
            font-weight: bold;
        }


        #top {
            width: 100%;
            background-color: white;
        }

        #search-bar {
            margin: 0px 2px 0px 2px;
            padding-left: 10px;
            padding-right: 10px;
            @apply --paper-material-elevation-1;
        }

        .logo-img {
            height: 50px;
        }

        .logo-img-small {
            height: 40px;
        }

        #home-page {
            background-color:
        }

        #icon {
            color: #404040;
            ;
        }


        app-toolbar {
            padding-left: 0px;

            height: 48px;
        }

        .title-bar-text p {}

        .link-label {
            line-height: 100%;
        }

        .secondary-title {
            font-size: 16px;
        }

        #ilab,
        #dol {
            pointer-events: auto;
        }

        @media (max-height:630px) {
            #step-list-scroll {
                overflow-y: auto;
                max-height: 225px;
            }
        }

        .topic-link {
            padding-left: 20px;
            max-width: 200px;
        }

        #bread-crumbs-container {
            margin-left: 10px;
        }

        #icon-background {
            width: 30px;
            height: 30px;
            background: white;
            border-radius: 50%;
            position: absolute;
            margin: 5px;
        }
        #pageContent:focus { 
            outline: none;
        }
        </style>
        <global-data locale="{{lang}}"></global-data>
        <app-route route="{{route}}" pattern="/:page" data="{{routeData}}" tail="{{subroute}}"></app-route>
        <app-route route="[[route]]" pattern="/:page/:stepId" data="{{routeData}}"></app-route>
        <app-route route="[[route]]" pattern="/:page/:stepId/:topicId" data="{{routeData}}"></app-route>
        <app-drawer-layout class="temp-width" fullbleed="" force-narrow="">
            <!-- Drawer content -->
            <app-drawer id="drawer" slot="drawer" persistent="">
                <app-toolbar>
                    <div class="layout horizontal flex">
                        <p class="flex">
                            <localized-data value="menu"></localized-data>
                        </p>

                        <p>
                            <paper-icon-button icon="icons:close" id="close-menu-btn" aria-label="Close Menu"></paper-icon-button>
                        </p>
                    </div>
                </app-toolbar>
                <iron-selector selected="[[page]]" attr-for-selected="name" class="drawer-list" role="navigation" fallback-selection="steps-landing">
                    <paper-dropdown-menu hidden="" label="Language" on-iron-select="_itemSelected">
                        <paper-listbox attr-for-selected="lang" slot="dropdown-content" selected="{{lang}}">
                            <paper-item lang="en">English</paper-item>
                            <paper-item lang="es">Espanol</paper-item>
                            <paper-item lang="fr">French</paper-item>
                        </paper-listbox>
                    </paper-dropdown-menu>
                    <app-link name="home" href="/home">
                        <localized-data value="home"></localized-data>
                    </app-link>
                    <app-link name="index-info" href="/info-about-page">
                        <localized-data value="about_this_app"></localized-data>
                    </app-link>
                    <app-link name="what-are-cl-fl" href="/info-what-are-page">
                        <localized-data value="what_are"></localized-data>
                    </app-link>
                    <border-separator></border-separator>
                    <div id="step-list-scroll" aria-live="polite">
                        <iron-pages selected="[[menuState]]" attr-for-selected="state" fallback-selection="none" role="secondary">
                            <div class="layout horizontal" state="none">
                                <app-link class="flex" href="/steps-landing"><localized-data value="steps"></localized-data></app-link>
                                <paper-icon-button icon="expand-more" on-click="showSteps" aria-label="Expand list of Steps"></paper-icon-button>
                            </div>
                            <div state="listSteps">
                                <div class="layout horizontal">
                                    <app-link class="flex" href="/steps-landing"><strong><localized-data value="steps"></localized-data></strong></app-link>
                                    <paper-icon-button icon="expand-less" on-click="menuBack" aria-label="Collapse list of steps"></paper-icon-button>
                                </div>
                                <dom-repeat items="[[stepData]]">
                                    <template>
                                        <div class="layout horizontal">
                                            <app-link class="flex" href="/step/[[item.index]]">
                                                <localized-data value="stepPrefix"></localized-data> [[item.index]]
                                            </app-link>
                                            <paper-icon-button icon="expand-more" step-target="[[item]]" data-index$="[[item.index]]" data-test-index="[[item.index]]" on-click="gotoStep" aria-label$="Expand to list of topics for Step [[item.index]]"></paper-icon-button>
                                        </div>
                                    </template>
                                </dom-repeat>
                            </div>
                            <div state="listTopics">
                                <div class="layout horizontal">
                                    <app-link class="flex" href="/step/[[currentMenuStep.index]]"><strong><localized-data value="step"></localized-data> [[currentMenuStep.index]]</strong></app-link>
                                    <paper-icon-button icon="expand-less" on-click="menuBack" aria-label="Collapse list of topics"></paper-icon-button>
                                </div>
                                <dom-repeat items="[[currentMenuStep.topics]]">
                                    <template>
                                        <div class="layout horizontal">
                                            <div class="topic-link">
                                                <app-link class="flex " href="/topic/[[currentMenuStep.index]]/[[item.index]]">
                                                    <p class="link-label">[[item.title]]</p>
                                                </app-link>
                                            </div>
                                        </div>
                                    </template>
                                </dom-repeat>
                            </div>
                        </iron-pages>
                    </div>
                    <border-separator></border-separator>
                    <app-link name="key-resources" href="/info-key-resources">
                        <localized-data value="key_r"></localized-data>
                    </app-link>
                    <a href="mailto:GlobalKids@dol.gov?subject=Comments on Comply Chain App" target="_top"><localized-data value="contact_us"></localized-data></a>
                </iron-selector>
            </app-drawer>
            <!-- Main content -->
            <app-header-layout id="scrollingRegion" has-scrolling-region="">
                <app-header slot="header" id="app-header" fixed="" scroll-target="scrollingRegion">
                    <app-toolbar>
                        <paper-icon-button icon="my-icons:menu" drawer-toggle="" aria-label="Menu"></paper-icon-button>
                        <div main-title="" class="layout horizontal">
                            <div class="flex-none layout vertical center-justified"><a href="https://www.dol.gov/agencies/ilab"> <img id="ilab" alt="ILAB - The Bureau of International Labor Affairs" class="logo-img-small" src="imgs/ilab.png"></a></div>
                            <div class="flex layout horizontal center-justified">
                                <div class="layout vertical title-bar-text">
                                    <div class="flex layout horizontal center-justified" style="margin-bottom: 50%">
                                        <p><strong>Comply Chain</strong></p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex-none layout vertical center-justified"><a href="https://www.dol.gov/"><img id="dol" alt="United States Department of Labor" class="logo-img" src="imgs/dol.png"></a></div>
                        </div>
                    </app-toolbar>
                </app-header>
                <div class="not-inside-content">
                    <div id="top">
                        <div hidden$="[[!isSearching]]">
                            <div id="search-bar">
                                <iron-a11y-keys id="a11y" keys="enter" on-keys-pressed="onSearch" target="[[searchInputTarget]]"></iron-a11y-keys>
                                <paper-input id="search-input" value="{{searchText}}" placeholder="Search..."></paper-input>
                            </div>
                        </div>
                        <iron-pages id="bread-crumbs-container" selected="[[page]]" attr-for-selected="name" fallback-selection="default" role="secondary">
                            <div name="default" class="layout horizontal">
                                <bread-crumbs name="default" class="flex" route="[[route]]" step-data="[[stepData]]" is-searching="{{isSearching}}"></bread-crumbs>
                                <div>
                                    <paper-icon-button icon="icons:search" active="{{isSearching}}" toggles="" aria-label="Search" id="bread-crumbs-search"></paper-icon-button>
                                </div>
                            </div>
                            <div name="home"></div>
                            <div name="home-fr"></div>
                            <div name="home-es"></div>
                        </iron-pages>
                    </div>
                    <iron-pages selected="[[page]]" id="pageContent" tabindex="-1" attr-for-selected="name" fallback-selection="home" role="main">
                        <div name="home">
                            <my-home route="[[subroute]]">
                                <div slot="append" class="layout horizontal">
                                    <div class="flex">
                                    </div>
                                    <div>
                                        <div id="icon-background"></div>
                                        <paper-icon-button id="icon" icon="icons:search" active="{{isSearching}}" toggles="" aria-label="Search"></paper-icon-button>
                                    </div>
                                </div>
                            </my-home>
                        </div>
                        <div name="home-fr">
                            <my-home-fr route="[[subroute]]">
                                <div slot="append" class="layout horizontal">
                                    <div class="flex">
                                    </div>
                                    <div>
                                        <div id="icon-background"></div>
                                        <paper-icon-button id="icon" icon="icons:search" active="{{isSearching}}" toggles="" aria-label="Search"></paper-icon-button>
                                    </div>
                                </div>
                            </my-home-fr>
                        </div>
                        <div name="home-es">
                            <my-home-es route="[[subroute]]">
                                <div slot="append" class="layout horizontal">
                                    <div class="flex">
                                    </div>
                                    <div>
                                        <div id="icon-background"></div>
                                        <paper-icon-button id="icon" icon="icons:search" active="{{isSearching}}" toggles="" aria-label="Search"></paper-icon-button>
                                    </div>
                                </div>
                            </my-home-es>
                        </div>

                        <my-step-splash name="step" route="[[subroute]]" step-data="[[stepData]]"></my-step-splash>
                        <my-topic target-id="{{targetId}}" name="topic" route="[[subroute]]" step-data="[[stepData]]" id="topic"></my-topic>
                        <info-page target-id="{{targetId}}" name="info" info-data="[[infoDataVisible]]" route="[[subroute]]"></info-page>
                        <search-results id="search" aria-live="polite" name="search-results" route="[[subroute]]" search-term="[[searchText]]" step-data="[[stepData]]" info-data="[[infoData]]"></search-results>
                        <steps-landing id="landing" name="steps-landing" route="[[subroute]]">
                            <slot></slot>
                        </steps-landing>
                        <dom-repeat items="{{infoData}}">
                            <template>
                                <info-sub-page target-id="{{targetId}}" name="[[item.id]]" target-data="[[infoFor(infoData, item.id)]]" html-content="{{item.content}}"></info-sub-page>
                            </template>
                        </dom-repeat>
                        <index-info name="index-info"></index-info>
                        <mockup-page name="mockup-page"></mockup-page>
                    </iron-pages>
                </div>
            </app-header-layout>
        </app-drawer-layout>
    </template>
    <script>var MyApp = function (_Polymer$Element) {
    babelHelpers.inherits(MyApp, _Polymer$Element);
    babelHelpers.createClass(MyApp, [{
        key: 'menuBack',
        value: function menuBack() {
            if (this.menuState === "listTopics") {
                this.menuState = "listSteps";
            } else if (this.menuState === "listSteps") {
                this.menuState = "none";
            }
            console.log("menuBack:" + this.menuState);
        }
    }, {
        key: 'showSteps',
        value: function showSteps() {
            this.menuState = "listSteps";
            console.log("showSteps:" + this.menuState);
        }
    }, {
        key: 'gotoStep',
        value: function gotoStep(e) {
            this.currentMenuStep = e.target.stepTarget;
            this.menuState = "listTopics";
            console.log("gotoStep:" + this.menuState);
            console.log("stepid:" + this.currentMenuStep);
            console.log("stepid:" + e.target.dataset.index);
            console.log("stepid:" + e.target.dataset.testIndex);
            console.log("stepid:" + e.target.index);
            console.log("stepid:" + e.target.testIndex);
        }
    }, {
        key: '_searchChange',
        value: function _searchChange(isSearching) {
            if (isSearching) {
                //this.$['search-input'].focus();

            }
        }
    }, {
        key: 'onSearch',
        value: function onSearch() {
            var _this2 = this;

            this.set('route.path', '/search-results');
            this.$.search.initiateSearch();
            setTimeout(function () {
                window.scrollTo(0, 0);
                _this2.root.querySelector('bread-crumbs').scrollIntoView();
                if (_this2.$.search.results.length === 1) {
                    var item = _this2.$.search.results[0];
                    if (item.type === "step") {
                        _this2.set('route.path', '/step/' + item.index);
                    }
                    if (item.type === "info") {
                        _this2.set('route.path', '/' + item.id);
                    }
                    if (item.type === "topic") {
                        _this2.set('route.path', '/topic/' + item.stepIndex + '/' + item.index);
                    }
                }
            }, 15);
        }
    }, {
        key: '_routePageChanged',
        value: function _routePageChanged(page) {
            // Polymer 2.0 will call with `undefined` on initialization.
            // Ignore until we are properly called with a string.
            if (page === undefined) {
                return;
            }

            // If no page was found in the route data, page will be an empty string.
            // Deault to 'home' in that case.
            this.page = page || 'home';
            if (this.page === "android_asset") {
                this.page = "home";
            }

            if (this.page == 'home' && localStorage.lang == 'fr') {
                this.page = "home-fr";
            }

            if (this.page == 'home' && localStorage.lang == 'es') {
                this.page = "home-es";
            }

            // Close a non-persistent drawer when the page & route are changed. 
            if (!this.$.drawer.persistent) {
                this.$.drawer.close();
            }
            if (this.page === "topic") {
                this.$.topic.refocusTop();
            }
            if (this.page !== 'search-results') {
                this.isSearching = false;
                this.searchText = "";
            }
        }
    }, {
        key: '_pageChanged',
        value: function _pageChanged(page) {
            var _this3 = this;

            // Load page import on demand. Show 404 page if fails
            var resolvedPageUrl = this.resolveUrl(page + '.html');
            if (/info.+/.exec(page)) {
                //resolvedPageUrl = this.resolveUrl('info-sub-page.html');
            } else {
                resolvedPageUrl = this.resolveUrl(page + '.html');
                app.deviceReadyPromise.then(function () {
                    Polymer.importHref(resolvedPageUrl, null, null, true);
                    if (page === "steps-landing") {
                        _this3.$.landing.recalcMap();
                    }
                });
            }
        }
    }, {
        key: '_itemSelected',
        value: function _itemSelected(e) {
            var selectedItem = e.target.selectedItem;

            var homepages = ["home", "home-es", "home-fr"];
            // if (e.target.selectedItem.lang != localStorage.lang && homepages.includes(this.page)) {
            if (e.target.selectedItem.lang != localStorage.lang) {
                window.localStorage.setItem("lang", e.target.selectedItem.lang);
                location.reload();
            }
        }
    }, {
        key: '_stepData',
        value: function _stepData(baseData, lang) {
            if (baseData === null) {
                return null;
            }
            if (lang == null) {
                this.lang = 'en';
                lang = 'en';
            }
            return baseData[lang].steps;
        }
    }, {
        key: '_infoData',
        value: function _infoData(baseData, lang) {
            if (baseData === null) {
                return null;
            }
            return baseData[lang].info;
        }
    }, {
        key: '_infoDataVisible',
        value: function _infoDataVisible(baseData, lang) {
            if (baseData === null) {
                return null;
            }
            return baseData[lang].info.filter(function (item) {
                return !item.hidden;
            });
        }
    }, {
        key: 'infoFor',
        value: function infoFor(target, id) {
            if (target === null || target === undefined) {
                return null;
            }
            return target.filter(function (item) {
                return item.id === id;
            })[0];
        }
    }], [{
        key: 'is',
        get: function get() {
            return 'my-app';
        }
    }, {
        key: 'properties',
        get: function get() {
            return {
                page: {
                    type: String,
                    reflectToAttribute: true,
                    observer: '_pageChanged'
                },
                baseStepData: {
                    type: Object,
                    value: null
                },
                stepData: {
                    type: Array,
                    computed: '_stepData(baseStepData, lang)'
                },
                infoData: {
                    type: Object,
                    computed: '_infoData(baseStepData, lang)'
                },
                infoDataVisible: {
                    type: Object,
                    computed: '_infoDataVisible(baseStepData, lang)'
                },
                lang: {
                    type: String,
                    value: "en"
                },
                isSearching: {
                    type: Boolean,
                    observer: '_searchChange'
                },
                target: {
                    type: Object
                },
                route: {
                    type: Object,
                    value: {
                        path: "/home"
                    }
                },
                menuState: {
                    type: String,
                    value: "none"
                },
                currentMenuStep: {
                    type: Object,
                    value: null
                }
            };
        }
    }, {
        key: 'observers',
        get: function get() {
            return ['_routePageChanged(routeData.page)'];
        }
    }]);

    function MyApp() {
        babelHelpers.classCallCheck(this, MyApp);
        return babelHelpers.possibleConstructorReturn(this, (MyApp.__proto__ || Object.getPrototypeOf(MyApp)).call(this));
    }

    babelHelpers.createClass(MyApp, [{
        key: 'connectedCallback',
        value: function connectedCallback() {
            var _this4 = this;

            babelHelpers.get(MyApp.prototype.__proto__ || Object.getPrototypeOf(MyApp.prototype), 'connectedCallback', this).call(this);

            this.root.querySelector('my-home').addEventListener('link-followed', function (event) {
                console.log(event.detail.target);
                _this4.root.querySelector('bread-crumbs').scrollIntoView();
                _this4.$['app-header'].scroll(0, 0);
                setTimeout(function () {
                    _this4.root.querySelector('bread-crumbs').scrollIntoView();
                    _this4.$['app-header'].scroll(0, 0);
                }, 16);
                //this.root.querySelector('bread-crumbs').scrollIntoView()
                _this4.set('route.path', event.detail.target);
                _this4.set('targetId', event.detail.id);
                if (!_this4.$.drawer.persistent) {
                    _this4.$.drawer.close();
                }
            });
            this.root.addEventListener('link-followed', function (event) {
                console.log(event.detail.target);
                _this4.root.querySelector('bread-crumbs').scrollIntoView();
                _this4.$['app-header'].scroll(0, 0);
                setTimeout(function () {
                    _this4.root.querySelector('bread-crumbs').scrollIntoView();
                    _this4.$['app-header'].scroll(0, 0);
                }, 16);
                _this4.set('route.path', event.detail.target);
                _this4.set('targetId', event.detail.id);
                if (!_this4.$.drawer.persistent) {
                    _this4.$.drawer.close();
                }
            });
            this.$.icon.addEventListener('click', function (event) {
                if (_this4.isSearching) {
                    _this4.$['search-input'].focus();
                }
            });
            this.$['bread-crumbs-search'].addEventListener('click', function (event) {
                if (_this4.isSearching) {
                    _this4.$['search-input'].focus();
                }
            });
            this.$['close-menu-btn'].addEventListener('click', function (event) {
                if (!_this4.$.drawer.persistent) {
                    _this4.$.drawer.close();
                    _this4.$.pageContent.focus();
                }
            });
        }
    }, {
        key: 'ready',
        value: function ready() {
            var _this5 = this;

            babelHelpers.get(MyApp.prototype.__proto__ || Object.getPrototypeOf(MyApp.prototype), 'ready', this).call(this);
            this.lang = window.localStorage.getItem("lang");
            this.searchInputTarget = this.$['search-input'];
            if (this.lang == 'en') {
                this.page = "home";
            } else if (this.lang == 'fr') {
                this.page = "home-fr";
            } else if (this.lang == 'es') {
                this.page = "home-es";
            }
            app.deviceReadyPromise.then(function () {
                return ajax('GET', "data.json");
            }).then(function (response) {
                console.log("got step data");
                _this5.baseStepData = JSON.parse(response);
                for (var lang in _this5.baseStepData) {

                    if (lang != _this5.lang) {
                        continue;
                    }

                    _this5.baseStepData[lang].steps.forEach(function (step) {
                        if (!!step.furtherResources) {
                            if (step.furtherResources[0] == "/") {
                                step.furtherResources = step.furtherResources.substr(1);
                            }
                            ajax('GET', step.furtherResources).then(function (result) {
                                console.log("found " + step.furtherResources);
                                step.furtherResources = result;
                            }).catch(function (error) {
                                console.log("didn't find bib.");
                            });
                        }
                        if (!!step.extraInfo) {
                            if (step.extraInfo[0] == "/") {
                                step.extraInfo = step.extraInfo.substr(1);
                            }
                            ajax('GET', step.extraInfo).then(function (result) {
                                console.log("found " + step.extraInfo);
                                step.extraInfo = result;
                            }).catch(function (error) {
                                console.log("didn't find extraInfo.");
                            });
                        }
                        if (!!step.trainingMats) {
                            if (step.trainingMats[0] == "/") {
                                step.trainingMats = step.trainingMats.substr(1);
                            }
                            ajax('GET', step.trainingMats).then(function (result) {
                                console.log("found " + step.trainingMats);
                                step.trainingMats = result;
                            }).catch(function (error) {
                                console.log("didn't find trainingMats.");
                            });
                        }
                        step.topics.forEach(function (topic) {
                            if (!!topic.url) {
                                if (topic.url[0] == "/") {
                                    topic.url = topic.url.substr(1);
                                    console.log(topic.url);
                                }
                                ajax('GET', topic.url).then(function (result) {
                                    console.log("found " + topic.url);
                                    topic.rawData = result;
                                }).catch(function (error) {
                                    console.log("didn't find topic.");
                                });
                            }
                        });
                    });
                }
            }).catch(function (error) {
                console.log("error loading step data: " + error);
            });
        }
    }]);
    return MyApp;
}(Polymer.Element);

window.customElements.define(MyApp.is, MyApp);</script>
</dom-module>